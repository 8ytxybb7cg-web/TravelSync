<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>Travel Sync Ultimate (v251222-6.2)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

  <style>
    /* --- Base Variables (Mixed 6.1 & 5.09) --- */
    :root {
      --ios-bg: #F2F2F7;
      --ios-card-bg: rgba(255, 255, 255, 0.65);
      --ios-card-border: rgba(255, 255, 255, 0.4);
      --glass-blur: 25px;
      --ios-primary: #007AFF;
      --ios-danger: #FF3B30;
      --ios-success: #34C759;
    }

    body {
      background-color: var(--ios-bg);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #000;
      -webkit-font-smoothing: antialiased;
      padding-bottom: 40px;
      user-select: none; /* iOS Native Feel */
    }

    /* --- 6.1 Standard Card --- */
    .ios-card {
      background: var(--ios-card-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border: 1px solid var(--ios-card-border);
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden; /* Ensure consistent container */
    }

    /* --- 5.09 Premium Dark Glass Flight Card (Ported) --- */
    .ios-card-dark-glass {
      background: rgba(22, 22, 24, 0.85); [span_4](start_span)/*[span_4](end_span) */
      backdrop-filter: blur(50px); [span_5](start_span)/*[span_5](end_span) */
      -webkit-backdrop-filter: blur(50px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px; /* Match 6.1 radius */
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4); [span_6](start_span)/*[span_6](end_span) */
      color: white;
      position: relative;
      overflow: hidden;
    }

    .dark-glass-gradient {
        position: absolute;
        top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle at 80% 20%, rgba(10, 132, 255, 0.25), transparent 60%); [span_7](start_span)/*[span_7](end_span) */
        pointer-events: none; z-index: 0;
    }

    /* --- High Contrast Toggle Button (New Request) --- */
    .glass-btn-high-contrast {
        background: rgba(0, 0, 0, 0.6); /* Darker background */
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    
    [cite_start]/* --- Sortable & Dragging Styles [cite: 21-23] --- */
    .sortable-ghost { opacity: 0.4; background: #e5e7eb; border: 1px dashed #9ca3af; }
    .sortable-drag { opacity: 1; background: #fff; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); transform: scale(1.02); z-index: 50; }
    .drag-handle { cursor: grab; touch-action: none; }

    [cite_start]/* --- 5.09 Modal System [cite: 37-43] --- */
    .modal-backdrop { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px); z-index: 100; transition: opacity 0.3s; }
    .ios-modal-container {
      background: rgba(250, 250, 250, 0.9);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-radius: 32px;
      display: flex; flex-direction: column;
      max-height: 90vh; width: 90%; max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.4);
    }
    .ios-modal-header { padding: 16px; text-align: center; font-weight: 600; font-size: 17px; border-bottom: 0.5px solid rgba(0,0,0,0.1); }
    .ios-modal-body { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
    .ios-modal-footer { padding: 16px 20px; border-top: 0.5px solid rgba(0,0,0,0.1); display: flex; gap: 12px; background: rgba(255,255,255,0.5); }
    
    .btn-ios-cancel { flex: 1; height: 44px; border-radius: 12px; background: rgba(118, 118, 128, 0.12); color: #000; font-weight: 600; }
    .btn-ios-primary { flex: 1; height: 44px; border-radius: 12px; background: var(--ios-primary); color: white; font-weight: 600; box-shadow: 0 0 15px rgba(0, 122, 255, 0.4); }

    [cite_start]/* --- Calculator Styles [cite: 50-56] --- */
    .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
    .calc-btn { border-radius: 10px; background: white; font-size: 20px; font-weight: 500; color: #333; height: 44px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .calc-btn:active { background: #E5E5EA; }
    .calc-btn.op { background: #FF9500; color: white; font-weight: 600; }
    .calc-btn.top-op { background: #D1D1D6; color: black; }
    .calc-btn.done-btn { background: var(--ios-primary); color: white; font-weight: 600; }

    /* Utilities */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .ios-input { background: rgba(118, 118, 128, 0.12); border: none; border-radius: 10px; padding: 10px 12px; width: 100%; font-size: 16px; outline: none; transition: background 0.2s; }
    .ios-input:focus { background: rgba(118, 118, 128, 0.2); }
    
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
  </style>
</head>
<body class="bg-[#F2F2F7] min-h-screen text-slate-800">

  <div id="app" class="max-w-md mx-auto relative pb-32">

    <header 
      class="sticky top-0 z-50 pt-12 pb-2 px-6 flex justify-between items-end bg-[#F2F2F7]/90 backdrop-blur-md transition-all duration-300"
      :class="{ 'shadow-sm border-b border-gray-200/50': isScrolled }"
    >
      <div>
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5 font-mono">
           {{ appVersion }} <span v-if="syncState === 'saving'" class="text-blue-500 animate-pulse ml-1">Saving...</span>
        </div>
        <h1 class="text-3xl font-bold text-black tracking-tight flex items-center gap-2">
          HKG <i class="ph-bold ph-airplane-tilt text-blue-500"></i> KIX
        </h1>
      </div>

      <div class="flex flex-col items-end gap-2">
         <button @click="toggleLang" class="text-[10px] font-bold bg-gray-200/80 text-gray-600 px-2 py-0.5 rounded-md hover:bg-gray-300 transition-colors">
            {{ lang === 'zh' ? 'EN' : '繁' }}
         </button>
         <button @click="modalState.member = true" class="relative group">
            <div class="w-10 h-10 rounded-full bg-gray-200 border-2 border-white shadow-sm overflow-hidden flex items-center justify-center text-gray-500 hover:scale-105 transition-transform">
               <i class="ph-fill ph-users text-xl"></i>
            </div>
            <span v-if="members.length > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm">
               {{ members.length }}
            </span>
         </button>
      </div>
    </header>

    <main class="px-5 space-y-5 mt-4">

      <div class="relative transition-all duration-500">
        
        <div class="absolute top-4 left-4 z-30">
          <button 
            @click="toggleSkin" 
            class="glass-btn-high-contrast px-3 py-1.5 rounded-full text-[10px] font-bold transition-all active:scale-95 flex items-center gap-1 cursor-pointer"
          >
            <span v-if="flightCardSkin === 'ios'">HKG <i class="ph ph-arrows-left-right ml-0.5 text-white/80"></i></span>
            <span v-else>iOS <i class="ph ph-arrows-left-right ml-0.5 text-white/80"></i></span>
          </button>
        </div>

        <div v-if="flightCardSkin === 'ios'" class="ios-card-dark-glass p-0 shadow-xl relative group min-h-[220px]">
          <div class="dark-glass-gradient"></div> <div class="relative z-10 p-6 flex flex-col justify-between h-full">
            
            <div class="flex justify-between items-start mt-8">
               <div>
                  <div class="text-3xl font-bold tracking-tight text-white">{{ activeFlight.flight_iata }}</div>
                  <div class="text-xs text-white/60 font-medium tracking-wide uppercase">{{ activeFlight.airline_name }}</div>
               </div>
               
               <a v-if="activeFlight.liveLink" :href="activeFlight.liveLink" target="_blank" 
                  class="flex items-center gap-1.5 bg-white/10 hover:bg-white/20 border border-white/10 px-3 py-1.5 rounded-full text-[11px] font-bold text-white transition-all active:scale-95 cursor-pointer backdrop-blur-md">
                 <i class="ph ph-broadcast text-[#34C759] animate-pulse"></i>
                 {{ t('activeFlightText') }}
                 <i class="ph ph-arrow-square-out text-xs opacity-50"></i>
               </a>
            </div>

            <div class="mt-6 flex justify-between items-end">
              <div class="text-left">
                <div class="text-5xl font-bold text-white tracking-tight">{{ activeFlight.origin_iata }}</div>
                <div class="text-sm font-mono text-white/80 mt-1">{{ formatTime(activeFlight.dep_time) }}</div>
              </div>

              <div class="flex flex-col items-center justify-center pb-2 opacity-60">
                <i class="ph-fill ph-airplane text-2xl rotate-90 mb-1 text-blue-400"></i>
                <span class="text-[10px] font-mono tracking-wide">{{ activeFlight.duration }}</span>
              </div>

              <div class="text-right flex flex-col items-end">
                <div :class="getStatusClass(activeFlight.status)" class="px-2.5 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wide backdrop-blur-md mb-2 inline-block">
                  {{ activeFlight.status }}
                </div>
                <div class="text-5xl font-bold text-white tracking-tight">{{ activeFlight.dest_iata }}</div>
                <div class="text-sm font-mono text-white/80 mt-1">{{ formatTime(activeFlight.arr_time) }}</div>
              </div>
            </div>

            <div class="mt-6 pt-4 border-t border-white/10 flex justify-between text-xs font-medium text-white/70">
              <div class="flex gap-6">
                <div>
                  <span class="block text-white/30 text-[9px] uppercase tracking-widest">{{ t('terminal') }}</span>
                  <span class="text-lg text-white">{{ activeFlight.origin_terminal }}</span>
                </div>
                <div>
                  <span class="block text-white/30 text-[9px] uppercase tracking-widest">{{ t('gate') }}</span>
                  <span class="text-lg text-[#FFCC00]">{{ activeFlight.origin_gate }}</span>
                </div>
              </div>
              <div class="text-right">
                <span class="block text-white/30 text-[9px] uppercase tracking-widest">{{ t('arriveTerm') }}</span>
                <span class="text-lg text-white">{{ activeFlight.dest_terminal }}</span>
              </div>
            </div>
          </div>
        </div>

        <div v-else-if="flightCardSkin === 'hkg'" class="rounded-[20px] overflow-hidden shadow-lg bg-white font-sans relative border border-gray-100 flex flex-col min-h-[220px]">
          
          <div class="bg-[#353E53] text-[#E9EB4F] px-5 py-3 flex justify-center items-center relative min-h-[60px]">
            <div class="flex flex-col items-center">
              <span class="text-[10px] opacity-80 uppercase tracking-widest font-semibold">{{ t('gate') }}</span>
              <span class="text-4xl font-bold leading-none mt-1">{{ activeFlight.origin_gate || '--' }}</span>
            </div>
            
            <div class="flex flex-col items-end gap-1 absolute right-3 top-3">
               <a v-if="activeFlight.liveLink" :href="activeFlight.liveLink" target="_blank" class="flex items-center gap-1.5 bg-white/20 hover:bg-white/30 border border-white/20 px-3 py-1.5 rounded-full text-[11px] font-bold text-white transition-all active:scale-95 cursor-pointer">
                  <i class="ph ph-broadcast text-[#34C759] animate-pulse"></i>
                  <span>{{ t('activeFlightText') }}</span>
               </a>
            </div>
          </div>

          <div class="px-5 py-6 bg-white relative flex-grow">
            <div class="absolute top-0 left-0 w-full h-[6px] bg-[#275CC0]"></div>
            
            <div class="flex justify-between items-end mt-2">
              <div class="flex flex-col items-center w-1/3">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-1 text-center">{{ t('estimatedDeparture') }}</span>
                <span class="text-3xl font-bold text-slate-800">{{ formatTime(activeFlight.dep_time) }}</span>
                <span class="text-sm font-semibold text-gray-500 mt-0.5">{{ activeFlight.origin_iata }}</span>
              </div>

              <div class="flex flex-col items-center justify-center w-1/3 pb-2">
                <div class="flex flex-col items-center">
                  <span class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mb-0.5 text-center">{{ t('flight') }}</span>
                  <span class="text-lg font-bold text-slate-800">{{ activeFlight.flight_iata }}</span>
                </div>
                <div class="w-full h-[1px] bg-gray-200 my-2 relative">
                  <i class="ph-fill ph-airplane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white px-1 text-gray-400 text-sm rotate-90"></i>
                </div>
                <span class="text-[10px] text-gray-400">{{ activeFlight.duration || '--' }}</span>
              </div>

              <div class="flex flex-col items-center w-1/3">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-1 text-center">{{ t('estimatedArrival') }}</span>
                <span class="text-3xl font-bold text-slate-800">{{ formatTime(activeFlight.arr_time) }}</span>
                <span class="text-sm font-semibold text-gray-500 mt-0.5">{{ activeFlight.dest_iata }}</span>
              </div>
            </div>
          </div>

          <div class="bg-[#BF443B] text-white px-5 py-4 flex justify-between items-center">
             <div class="flex flex-col">
                <span class="text-[10px] text-white/70 font-bold uppercase tracking-widest">{{ t('cabin') }}</span>
                <span class="text-sm font-bold">ECONOMY</span>
             </div>
             <div class="text-right">
                <div class="text-xs font-bold uppercase tracking-wide">
                   {{ activeFlight.origin_iata }} T{{ activeFlight.origin_terminal }} <span class="mx-0.5 text-white/70 font-normal normal-case">{{ t('to') }}</span> {{ activeFlight.dest_iata }}
                </div>
                <div class="text-[10px] text-white/80 mt-0.5">{{ displayDate(activeFlight.dep_time) }}</div>
             </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="ios-card p-4 relative overflow-hidden group">
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-lg">
                <i class="ph-bold ph-currency-yen"></i>
              </div>
              <span class="text-xs font-bold text-gray-500 uppercase">{{ t('rate') }}</span>
            </div>
          </div>
          <div class="flex flex-col">
            <div class="text-3xl font-bold text-slate-800 tracking-tight">
              {{ currentLiveRate ? currentLiveRate.toFixed(3) : rate }}
            </div>
            <div class="text-[10px] text-gray-400 mt-1">{{ lastRateUpdateLabel }}</div>
          </div>
        </div>

        <div class="ios-card p-4 flex flex-col justify-between group cursor-pointer hover:bg-white/80 transition-colors">
          <div class="flex justify-between items-start">
            <div class="w-8 h-8 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center text-lg">
              <i class="ph-fill ph-sun"></i>
            </div>
            <span class="text-xs font-bold text-gray-400">OSAKA</span>
          </div>
          <div class="mt-2">
            <div class="text-3xl font-bold text-slate-800">18°C</div>
            <div class="text-xs text-gray-500 font-medium">Sunny</div>
          </div>
        </div>
      </div>

      <section>
        <div class="flex items-center justify-between mb-3 px-1">
          <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <i class="ph-fill ph-calendar-check text-blue-500"></i> {{ t('itinerary') }}
          </h2>
          <button @click="openModal('itinerary')" class="text-blue-500 text-sm font-medium hover:bg-blue-50 px-2 py-1 rounded-lg transition-colors">
            + {{ t('addEvent') }}
          </button>
        </div>

        <div class="flex overflow-x-auto gap-3 pb-4 no-scrollbar -mx-5 px-5 snap-x">
          <div v-for="(dayItems, date) in itinerary" :key="date" class="snap-center shrink-0 w-[280px] ios-card p-4 flex flex-col gap-3 h-full">
            <div class="flex justify-between items-center border-b border-gray-200/50 pb-2">
              <span class="font-bold text-slate-700">{{ displayDate(date) }}</span>
              <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full font-medium">{{ dayItems.length }} {{ t('items') }}</span>
            </div>

            <div class="flex flex-col gap-2 max-h-[200px] overflow-y-auto pr-1 custom-scroll">
              <div v-for="item in dayItems" :key="item.id" @click="openModal('itinerary', item)" class="bg-white/50 p-2.5 rounded-xl border border-white/40 shadow-sm flex gap-3 items-center active:scale-98 transition-transform cursor-pointer">
                <div class="flex flex-col items-center justify-center min-w-[40px] text-center border-r border-gray-200 pr-2">
                  <span class="text-sm font-bold text-slate-800">{{ item.time }}</span>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="font-semibold text-slate-800 truncate text-sm">{{ item.title }}</div>
                  <div class="text-[11px] text-gray-500 truncate">{{ item.location }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="ios-card p-5">
         <div class="flex items-center justify-between mb-4">
           <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
             <i class="ph-fill ph-check-square text-green-500"></i> {{ t('prepList') }}
           </h2>
           <button @click="openModal('prep')" class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center hover:bg-green-200 transition-colors">
             <i class="ph-bold ph-plus"></i>
           </button>
         </div>
         <ul class="space-y-2">
           <li v-for="item in prepList" :key="item.id" class="flex items-center justify-between p-3 bg-white/60 rounded-xl border border-white/50 shadow-sm">
             <div class="flex items-center gap-3 overflow-hidden w-full">
               <button @click="item.done = !item.done; saveAll()" class="text-gray-400 hover:text-green-500 transition-colors shrink-0">
                 <i :class="item.done ? 'ph-fill ph-check-circle text-green-500' : 'ph-bold ph-circle'"></i>
               </button>
               <span @click="openModal('prep', item)" :class="{'line-through text-gray-400': item.done}" class="font-medium text-slate-800 truncate flex-1 cursor-pointer">{{ item.name }}</span>
             </div>
           </li>
         </ul>
      </div>

      <div class="ios-card p-5">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <i class="ph-fill ph-shopping-bag text-pink-500"></i> {{ t('shopping') }}
          </h2>
          <button @click="openModal('shopping')" class="w-8 h-8 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center hover:bg-pink-200 transition-colors">
            <i class="ph-bold ph-plus"></i>
          </button>
        </div>
        <ul class="space-y-2 shopping-list-container">
          <li v-for="item in shoppingList" :key="item.id" class="flex items-center justify-between p-3 bg-white/60 rounded-xl border border-white/50 shadow-sm group drag-handle touch-manipulation">
            <div class="flex items-center gap-3 overflow-hidden w-full">
              <button @click.stop="item.done = !item.done; saveAll()" class="text-gray-400 hover:text-green-500 transition-colors shrink-0">
                <i :class="item.done ? 'ph-fill ph-check-circle text-green-500' : 'ph-bold ph-circle'"></i>
              </button>
              <div @click="openModal('shopping', item)" class="flex flex-col min-w-0 flex-1 cursor-pointer">
                <span :class="{'line-through text-gray-400': item.done}" class="font-medium text-slate-800 truncate">{{ item.name }}</span>
                <span v-if="item.price" class="text-xs text-gray-500">¥{{ item.price }}</span>
              </div>
              <i class="ph-bold ph-dots-six-vertical text-gray-300"></i>
            </div>
          </li>
        </ul>
      </div>

      <section class="ios-card p-5 bg-gradient-to-br from-slate-800 to-slate-900 text-white border-none">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-bold flex items-center gap-2">
            <i class="ph-fill ph-receipt text-yellow-400"></i> {{ t('expenses') }}
          </h2>
          <div class="flex gap-2">
              <button @click="modalState.settlement = true" class="bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-xs font-bold transition-colors">
                {{ t('settlement') }}
              </button>
              <button @click="openModal('expense')" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-full text-xs font-bold transition-colors shadow-lg shadow-blue-500/30">
                + Add
              </button>
          </div>
        </div>
        
        <div class="flex items-end gap-2 mb-6">
          <span class="text-4xl font-bold tracking-tight">HKD {{ formatNumber(totalExpense.toFixed(0)) }}</span>
        </div>

        <div class="grid grid-cols-3 gap-2">
          <div class="bg-white/10 rounded-lg p-2 text-center">
            <div class="text-[10px] text-gray-400 uppercase tracking-wider">{{ t('food') }}</div>
            <div class="font-bold text-sm mt-0.5">{{ formatNumber(expensesBreakdown.food.toFixed(0)) }}</div>
          </div>
          <div class="bg-white/10 rounded-lg p-2 text-center">
            <div class="text-[10px] text-gray-400 uppercase tracking-wider">{{ t('transport') }}</div>
            <div class="font-bold text-sm mt-0.5">{{ formatNumber(expensesBreakdown.transport.toFixed(0)) }}</div>
          </div>
          <div class="bg-white/10 rounded-lg p-2 text-center">
            <div class="text-[10px] text-gray-400 uppercase tracking-wider">{{ t('shop') }}</div>
            <div class="font-bold text-sm mt-0.5">{{ formatNumber(expensesBreakdown.shopping.toFixed(0)) }}</div>
          </div>
        </div>
        
        <div class="mt-4 space-y-2 max-h-[200px] overflow-y-auto custom-scroll pr-1">
             <div v-for="exp in expenses" :key="exp.id" @click="openModal('expense', exp)" class="flex justify-between items-center p-2 rounded bg-white/5 border border-white/10 text-sm active:bg-white/10">
                 <div class="flex items-center gap-2">
                     <span class="w-1 h-8 bg-yellow-400 rounded-full"></span>
                     <div>
                         <div class="font-bold">{{ exp.name }}</div>
                         <div class="text-[10px] text-gray-400">{{ exp.payer }} paid</div>
                     </div>
                 </div>
                 <div class="text-right">
                     <div class="font-mono">¥{{ formatNumber(exp.amount) }}</div>
                     <div class="text-[10px] text-gray-400">{{ exp.date }}</div>
                 </div>
             </div>
        </div>
      </section>

      <section class="ios-card p-5 bg-blue-50/50 border-blue-100 mb-6">
         <h2 class="text-sm font-bold text-blue-800 mb-2 flex items-center gap-2">
            <i class="ph-fill ph-info"></i> {{ t('info') }}
         </h2>
         <p class="text-xs text-blue-900/70 leading-relaxed whitespace-pre-line">{{ infoText }}</p>
      </section>

    </main>

    <nav class="fixed bottom-0 w-full max-w-md bg-white/80 backdrop-blur-xl border-t border-gray-200/50 pb-safe pt-2 px-6 flex justify-between items-center z-40 text-gray-400">
      <button class="flex flex-col items-center gap-0 text-blue-600">
        <i class="ph-fill ph-house text-2xl mb-0.5"></i>
        <span class="text-[10px] font-medium leading-none">{{ t('home') }}</span>
      </button>
      <button class="flex flex-col items-center gap-0 hover:text-blue-500 transition-colors">
        <i class="ph-bold ph-map-trifold text-2xl mb-0.5"></i>
        <span class="text-[10px] font-medium leading-none">{{ t('map') }}</span>
      </button>
      <button class="flex flex-col items-center gap-0 hover:text-blue-500 transition-colors">
        <i class="ph-bold ph-wallet text-2xl mb-0.5"></i>
        <span class="text-[10px] font-medium leading-none">{{ t('wallet') }}</span>
      </button>
      <button class="flex flex-col items-center gap-0 hover:text-blue-500 transition-colors">
        <i class="ph-bold ph-gear text-2xl mb-0.5"></i>
        <span class="text-[10px] font-medium leading-none">{{ t('settings') }}</span>
      </button>
    </nav>

    <div v-if="modalState.expense" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container animate-fade-in-up">
            <div class="ios-modal-header">{{ newExpense.id ? t('editItem') : t('newItem') }}</div>
            <div class="ios-modal-body space-y-4">
                <div class="bg-gray-100 p-4 rounded-xl text-right">
                    <div class="text-xs text-gray-500 uppercase font-bold mb-1">Amount (JPY)</div>
                    <input readonly :value="newExpense.amount" class="w-full bg-transparent text-4xl font-bold text-right outline-none tracking-tight text-slate-800" placeholder="0">
                </div>
                
                <div class="calc-grid">
                    <button v-for="btn in ['7','8','9','/','4','5','6','*','1','2','3','-','C','0','.','+']" 
                        :key="btn" @click="handleCalcInput(btn)" 
                        class="calc-btn" :class="{'op': ['/','*','-','+'].includes(btn), 'text-red-500': btn==='C'}">
                        {{ btn }}
                    </button>
                    <button @click="handleCalcInput('DEL')" class="calc-btn col-span-4 bg-gray-200"><i class="ph-bold ph-backspace"></i></button>
                </div>

                <input v-model="newExpense.name" class="ios-input" placeholder="Item Name (e.g. Dinner)">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-gray-500 font-bold ml-1">{{ t('payer') }}</label>
                        <select v-model="newExpense.payer" class="ios-input mt-1">
                            <option v-for="m in members" :value="m">{{ m }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 font-bold ml-1">{{ t('food') }}/{{ t('shop') }}</label>
                        <select v-model="newExpense.category" class="ios-input mt-1">
                            <option value="餐飲">{{ t('food') }}</option>
                            <option value="交通">{{ t('transport') }}</option>
                            <option value="購物">{{ t('shop') }}</option>
                            <option value="其他">Other</option>
                        </select>
                    </div>
                </div>

                <div class="bg-gray-50 p-3 rounded-xl">
                    <div class="text-xs text-gray-500 font-bold mb-2">{{ t('involved') }}</div>
                    <div class="flex flex-wrap gap-2">
                        <button v-for="m in members" :key="m" 
                           @click="newExpense.involved.includes(m) ? newExpense.involved = newExpense.involved.filter(x=>x!==m) : newExpense.involved.push(m)"
                           class="px-3 py-1.5 rounded-full text-xs font-bold border transition-all"
                           :class="newExpense.involved.includes(m) ? 'bg-blue-500 text-white border-blue-600' : 'bg-white text-gray-500 border-gray-200'">
                           {{ m }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="ios-modal-footer">
                <button v-if="newExpense.id" @click="deleteItem('expense', newExpense.id); modalState.expense=false" class="btn-ios-cancel text-red-500">{{ t('delete') }}</button>
                <button @click="modalState.expense = false" class="btn-ios-cancel">{{ t('cancel') }}</button>
                <button @click="saveItem('expense')" class="btn-ios-primary">{{ t('save') }}</button>
            </div>
        </div>
    </div>

    <div v-if="modalState.settlement" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container">
            <div class="ios-modal-header">{{ t('settlement') }}</div>
            <div class="ios-modal-body space-y-3">
                 <div v-if="settlementList.length === 0" class="text-center text-gray-500 py-10">
                     All settled up!
                 </div>
                 <div v-for="item in settlementList" :key="item.name" class="flex justify-between items-center p-4 bg-white rounded-xl shadow-sm border border-gray-100">
                     <span class="font-bold text-lg">{{ item.name }}</span>
                     <div class="text-right">
                         <div class="text-xs text-gray-400 uppercase font-bold">
                             {{ item.amount > 0 ? t('shouldReceive') : t('shouldPay') }}
                         </div>
                         <div class="text-xl font-bold font-mono" :class="item.amount > 0 ? 'text-green-500' : 'text-red-500'">
                             {{ item.amount > 0 ? '+' : '' }}{{ formatNumber(item.amount.toFixed(0)) }}
                         </div>
                     </div>
                 </div>
            </div>
            <div class="ios-modal-footer">
                <button @click="modalState.settlement = false" class="btn-ios-cancel w-full">Close</button>
            </div>
        </div>
    </div>

    <div v-if="modalState.shopping" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container">
            <div class="ios-modal-header">{{ newShoppingItem.id ? t('editItem') : t('newItem') }}</div>
            <div class="ios-modal-body space-y-4">
                <input v-model="newShoppingItem.name" class="ios-input" placeholder="Item Name">
                <input v-model="newShoppingItem.price" type="number" class="ios-input" placeholder="Est. Price (¥)">
            </div>
            <div class="ios-modal-footer">
                <button v-if="newShoppingItem.id" @click="deleteItem('shopping', newShoppingItem.id); modalState.shopping=false" class="btn-ios-cancel text-red-500">{{ t('delete') }}</button>
                <button @click="modalState.shopping = false" class="btn-ios-cancel">{{ t('cancel') }}</button>
                <button @click="saveItem('shopping')" class="btn-ios-primary">{{ t('save') }}</button>
            </div>
        </div>
    </div>

    <div v-if="modalState.itinerary" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container">
            <div class="ios-modal-header">{{ t('itinerary') }}</div>
            <div class="ios-modal-body space-y-4">
                <input type="time" v-model="newItineraryItem.time" class="ios-input">
                <input v-model="newItineraryItem.title" class="ios-input" placeholder="Event Title">
                <input v-model="newItineraryItem.location" class="ios-input" placeholder="Location">
            </div>
            <div class="ios-modal-footer">
                <button v-if="newItineraryItem.id" @click="deleteItem('itinerary', newItineraryItem.id); modalState.itinerary=false" class="btn-ios-cancel text-red-500">{{ t('delete') }}</button>
                <button @click="modalState.itinerary = false" class="btn-ios-cancel">{{ t('cancel') }}</button>
                <button @click="saveItem('itinerary')" class="btn-ios-primary">{{ t('save') }}</button>
            </div>
        </div>
    </div>

    <div v-if="modalState.prep" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container">
            <div class="ios-modal-header">{{ t('prepList') }}</div>
            <div class="ios-modal-body space-y-4">
                <input v-model="newPreNote.name" class="ios-input" placeholder="Task Name">
            </div>
            <div class="ios-modal-footer">
                <button @click="modalState.prep = false" class="btn-ios-cancel">{{ t('cancel') }}</button>
                <button @click="prepList.push({ id: Date.now(), name: newPreNote.name, done: false }); modalState.prep = false; saveAll()" class="btn-ios-primary">{{ t('save') }}</button>
            </div>
        </div>
    </div>

    <div v-if="modalState.member" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4">
        <div class="ios-modal-container">
            <div class="ios-modal-header">Members</div>
            <div class="ios-modal-body space-y-2">
                <div v-for="m in members" :key="m" class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span>{{ m }}</span>
                    <button @click="members = members.filter(x => x !== m); saveAll()" class="text-red-500 font-bold">-</button>
                </div>
                <div class="flex gap-2 mt-4">
                    <input id="newMemberInput" class="ios-input" placeholder="New Member Name">
                    <button @click="members.push(document.getElementById('newMemberInput').value); saveAll()" class="bg-blue-500 text-white rounded-lg px-4 font-bold">+</button>
                </div>
            </div>
            <div class="ios-modal-footer">
                <button @click="modalState.member = false" class="btn-ios-cancel w-full">Done</button>
            </div>
        </div>
    </div>
  </div> 

  <script>
    const { createApp, ref, reactive, computed, onMounted, nextTick, watch } = Vue;
    const { createClient } = supabase;

    // --- Supabase Config ---
    const SUPABASE_URL = 'https://myrhatzdypiwwgmmfbuw.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_bnnah-2fsCaQnKZDoKNJQw_NuYQVvKi';
    const sb = createClient(SUPABASE_URL, SUPABASE_KEY);
    const TRIP_ID = 'testUI';

    createApp({
      setup() {
        // --- Global State ---
        const appVersion = ref('v251222-6.2');
        const lang = ref('zh'); 
        const flightCardSkin = ref('ios');
        const isScrolled = ref(false);
        const members = ref([1, 2]);
        const syncState = ref('synced');

        // --- Data Refs ---
        const prepList = ref([
           { id: 101, name: 'Passport & Visa', done: true },
           { id: 102, name: 'Power Bank', done: false }
        ]);
        const newPreNote = reactive({ name: '', isDone: false });
        
        const itinerary = ref({
          '2025-12-21': [
             { id: 1, title: 'Arrival at KIX', time: '14:40', location: 'Kansai Airport', category: 'travel', note: 'Pick up JR Pass' }
          ]
        });
        const newItineraryItem = reactive({ id: null, title: '', time: '', location: '', category: 'travel', note: '', dateKey: '' });

        const shoppingList = ref([
           { id: 201, name: 'Matcha KitKat', price: 300, done: false }
        ]);
        const newShoppingItem = reactive({ id: null, name: '', price: '', done: false });

        const expenses = ref([
            { id: 301, name: 'Dinner', amount: 12000, currency: 'JPY', category: '餐飲', payer: 1, involved: [1,2], paymentMethod: 'cash', date: '2025-12-21' }
        ]);
        const newExpense = reactive({ 
            id: null, name: '', amount: '', currency: 'JPY', category: '餐飲', 
            payer: '', involved: [], paymentMethod: 'cash', date: '' 
        });
        const expenseFilter = ref('all');
        const isDraggingExpense = ref(false);

        const activeFlight = ref({
          airline_iata: 'CX', airline_name: 'Cathay Pacific', flight_iata: 'CX506',
          origin_iata: 'HKG', origin_terminal: '1', origin_gate: '24',
          dest_iata: 'KIX', dest_terminal: '1',
          dep_time: '2025-12-21T10:00:00', arr_time: '2025-12-21T14:40:00',
          duration: '3h 40m', status: 'On Time', liveLink: 'https://flighty.com',
          note: 'Economy'
        });

        const infoText = ref("Remember to fill out the Visit Japan Web form.");
        const rate = ref(0.052);
        const currentLiveRate = ref(0.0518);
        const lastRateUpdateLabel = ref('Updated 10m ago');
        const calcInput = ref('');
        const calcResult = ref(0);

        // --- Modals Control ---
        const modalState = reactive({
            flight: false, member: false, rate: false,
            itinerary: false, shopping: false, prep: false,
            expense: false, settlement: false
        });

        // --- i18n Dictionary ---
        const i18n = {
           en: {
              activeFlightText: 'Active Flight', tapToAdd: 'Tap to add flight details',
              estimatedDeparture: 'Estimated Departure', estimatedArrival: 'Estimated Arrival',
              terminal: 'Terminal', gate: 'Gate', arriveTerm: 'Arrive Term', flight: 'Flight', cabin: 'Cabin', to: 'to',
              rate: 'JPY Rate', itinerary: 'Itinerary', addEvent: 'Add Event', items: 'items',
              prepList: 'Preparation', noPrepItems: 'All set! No items to display.',
              shopping: 'Shopping', expenses: 'Expenses', totalSpent: 'Total Spent',
              food: 'Food', transport: 'Transport', shop: 'Shop', info: 'Travel Info',
              home: 'Home', map: 'Map', wallet: 'Wallet', settings: 'Settings',
              edit: 'Edit', delete: 'Delete', save: 'Save', cancel: 'Cancel',
              newItem: 'New Item', editItem: 'Edit Item',
              payer: 'Payer', involved: 'Involved', selectAll: 'Select All',
              method: 'Method', cash: 'Cash', credit: 'Card',
              settlement: 'Settlement', shouldPay: 'Should Pay', shouldReceive: 'Should Receive',
              confirmDelete: 'Are you sure?', calcDone: 'Done'
           },
           zh: {
              activeFlightText: '航班實況', tapToAdd: '點擊新增航班資訊',
              estimatedDeparture: '預計起飛', estimatedArrival: '預計抵達',
              terminal: '客運大樓', gate: '登機閘口', arriveTerm: '抵達大樓', flight: '航班', cabin: '艙等', to: '前往',
              rate: '日圓匯率', itinerary: '行程安排', addEvent: '新增', items: '項目',
              prepList: '準備清單', noPrepItems: '準備就緒！暫無項目。',
              shopping: '購物清單', expenses: '支出', totalSpent: '總支出',
              food: '飲食', transport: '交通', shop: '購物', info: '旅程資訊',
              home: '首頁', map: '地圖', wallet: '錢包', settings: '設定',
              edit: '編輯', delete: '刪除', save: '儲存', cancel: '取消',
              newItem: '新增項目', editItem: '編輯項目',
              payer: '支付者', involved: '分帳人', selectAll: '全選',
              method: '支付', cash: '現金', credit: '信用卡',
              settlement: '結算', shouldPay: '需支付', shouldReceive: '需收取',
              confirmDelete: '確定刪除？', calcDone: '完成'
           }
        };
        const t = (key) => i18n[lang.value][key] || key;
        const toggleLang = () => { lang.value = lang.value === 'zh' ? 'en' : 'zh'; };
        const generateId = () => Date.now() + Math.floor(Math.random() * 1000);

        // --- Methods ---
        const toggleSkin = () => { flightCardSkin.value = flightCardSkin.value === 'ios' ? 'hkg' : 'ios'; };
        
        const formatTime = (isoString) => {
          if (!isoString) return '--:--';
          if(isoString.length === 5 && isoString.includes(':')) return isoString;
          const date = new Date(isoString);
          return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
        };
        
        const displayDate = (isoString) => {
          if (!isoString) return '';
          const date = new Date(isoString);
          return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }).toUpperCase();
        };

        const getStatusClass = (status) => {
           switch(status?.toLowerCase()) {
              case 'on time': return 'text-[#34C759] bg-[#34C759]/15 border border-[#34C759]/20';
              case 'delayed': return 'text-[#FF3B30] bg-[#FF3B30]/15 border border-[#FF3B30]/20';
              case 'boarding': return 'text-[#FFCC00] bg-[#FFCC00]/15 border border-[#FFCC00]/20';
              case 'landed': return 'text-[#007AFF] bg-[#007AFF]/15 border border-[#007AFF]/20';
              default: return 'bg-white/10 text-white border-white/20';
           }
        };

        const handleCalcInput = (key) => {
             let val = String(newExpense.amount || '');
             if (val === '0' && key !== '.' && !['+','-','*','/'].includes(key)) val = '';
             if (key === 'C') {
                 newExpense.amount = '';
             } else if (key === 'DEL') {
                 newExpense.amount = val.slice(0, -1);
             } else if (key === '=') {
                 try {
                     if(!val) return;
                     const safeVal = val.replace(/[^0-9+\-*/.]/g, '');
                     newExpense.amount = eval(safeVal); 
                 } catch (e) {}
             } else {
                 const lastChar = val.slice(-1);
                 const isOp = ['+','-','*','/'].includes(key);
                 const lastIsOp = ['+','-','*','/'].includes(lastChar);
                 if (isOp && lastIsOp) {
                     newExpense.amount = val.slice(0, -1) + key;
                 } else {
                     newExpense.amount = val + key;
                 }
             }
        };

        const openModal = (type, item = null) => {
            if(type === 'expense') {
                const def = { 
                    id: null, name:'', amount:'', currency:'JPY', category:'餐飲', 
                    paymentMethod:'cash', date: new Date().toISOString().split('T')[0],
                    payer: members.value[0], involved: [...members.value], 
                    exchangeRate: null 
                };
                Object.assign(newExpense, item ? JSON.parse(JSON.stringify(item)) : def);
                modalState.expense = true;
            } else if (type === 'shopping') {
                Object.assign(newShoppingItem, item ? JSON.parse(JSON.stringify(item)) : { id: null, name: '', price: '', done: false });
                modalState.shopping = true;
            } else if (type === 'itinerary') {
                Object.assign(newItineraryItem, item ? JSON.parse(JSON.stringify(item)) : { id: null, title: '', time: '', location: '', category: 'travel', note: '' });
                modalState.itinerary = true;
            } else if (type === 'prep') {
                Object.assign(newPreNote, item ? JSON.parse(JSON.stringify(item)) : { id: null, name: '', isDone: false });
                modalState.prep = true;
            }
        };

        const saveItem = (type) => {
             if(type === 'expense') {
                 if(!newExpense.amount) return;
                 const saveObj = { ...newExpense, id: newExpense.id || generateId() };
                 if(!saveObj.id) saveObj.order_index = expenses.value.length;
                 const idx = expenses.value.findIndex(e => e.id === saveObj.id);
                 if(idx !== -1) expenses.value.splice(idx, 1, saveObj);
                 else expenses.value.push(saveObj);
                 modalState.expense = false;
             }
             else if(type === 'shopping') {
                 const saveObj = { ...newShoppingItem, id: newShoppingItem.id || generateId() };
                 const idx = shoppingList.value.findIndex(e => e.id === saveObj.id);
                 if(idx !== -1) shoppingList.value.splice(idx, 1, saveObj);
                 else shoppingList.value.push(saveObj);
                 modalState.shopping = false;
             }
             else if(type === 'itinerary') {
                 const saveObj = { ...newItineraryItem, id: newItineraryItem.id || generateId() };
                 const targetDate = '2025-12-21'; 
                 if(!itinerary.value[targetDate]) itinerary.value[targetDate] = [];
                 const idx = itinerary.value[targetDate].findIndex(e => e.id === saveObj.id);
                 if(idx !== -1) itinerary.value[targetDate].splice(idx, 1, saveObj);
                 else itinerary.value[targetDate].push(saveObj);
                 
                 itinerary.value[targetDate].sort((a,b) => (a.time || '23:59').localeCompare(b.time || '23:59'));
                 modalState.itinerary = false;
             }
             saveAll();
        };

        const deleteItem = (type, id) => {
             if(!confirm(t('confirmDelete'))) return;
             if(type === 'expense') expenses.value = expenses.value.filter(e => e.id !== id);
             if(type === 'shopping') shoppingList.value = shoppingList.value.filter(e => e.id !== id);
             Object.keys(itinerary.value).forEach(date => {
                 itinerary.value[date] = itinerary.value[date].filter(e => e.id !== id);
             });
             saveAll();
        };

        const initSortable = (elClass, listRef) => {
            const els = document.querySelectorAll(elClass);
            els.forEach(el => {
                Sortable.create(el, {
                    handle: '.drag-handle',
                    animation: 150, delay: 150, delayOnTouchOnly: true,
                    onEnd: (evt) => {
                        const item = listRef.value.splice(evt.oldIndex, 1)[0];
                        listRef.value.splice(evt.newIndex, 0, item);
                        saveAll();
                    }
                });
            });
        };

        // --- Computed ---
        const totalExpense = computed(() => {
             let totalHKD = 0;
             expenses.value.forEach(e => {
                 let amt = Number(e.amount) || 0;
                 let hkdAmt = 0;
                 if(e.currency === 'JPY') hkdAmt = amt * 0.052; 
                 else if(e.currency === 'HKD') hkdAmt = amt;
                 totalHKD += hkdAmt;
             });
             return totalHKD;
        });

        const expensesBreakdown = computed(() => {
             const cats = { food: 0, transport: 0, shopping: 0 };
             expenses.value.forEach(e => {
                 let amt = Number(e.amount) || 0;
                 if(e.category === '餐飲') cats.food += amt;
                 if(e.category === '交通') cats.transport += amt;
                 if(e.category === '購物') cats.shopping += amt;
             });
             return cats;
        });

        const settlementList = computed(() => {
             const balances = {};
             members.value.forEach(m => balances[m] = 0);
             expenses.value.forEach(e => {
                 let amount = Number(e.amount) || 0;
                 let hkdAmt = (e.currency === 'JPY' ? amount * 0.052 : amount);
                 const payer = e.payer || members.value[0];
                 const involved = e.involved && e.involved.length > 0 ? e.involved : members.value;
                 
                 if(balances[payer] === undefined) balances[payer] = 0;
                 balances[payer] += hkdAmt;
                 const splitAmt = hkdAmt / involved.length;
                 involved.forEach(p => {
                     if(balances[p] === undefined) balances[p] = 0;
                     balances[p] -= splitAmt;
                 });
             });
             return Object.keys(balances).map(k => ({ name: k, amount: balances[k] })).filter(x => Math.abs(x.amount) > 1);
        });

        // --- Sync ---
        const fetchTripData = async () => {
           try {
              syncState.value = 'loading';
              const { data, error } = await sb.from('trip_data').select('*').eq('id', TRIP_ID).single();
              if (data?.content) {
                 const c = data.content;
                 if(c.itinerary) itinerary.value = c.itinerary;
                 if(c.expenses) expenses.value = c.expenses;
                 if(c.shoppingList) shoppingList.value = c.shoppingList;
                 if(c.members) members.value = c.members;
                 if(c.prepList) prepList.value = c.prepList;
              }
              syncState.value = 'synced';
           } catch (err) { console.error(err); syncState.value = 'error'; }
        };

        const saveAll = async () => {
            syncState.value = 'saving';
            const payload = {
                itinerary: itinerary.value, expenses: expenses.value,
                shoppingList: shoppingList.value, members: members.value,
                prepList: prepList.value, updated_at: Date.now()
            };
            await sb.from('trip_data').upsert({ id: TRIP_ID, content: payload });
            setTimeout(() => syncState.value = 'synced', 500);
        };

        // --- Lifecycle ---
        onMounted(() => {
          window.addEventListener('scroll', () => { isScrolled.value = window.scrollY > 10; });
          fetchTripData();
        });

                watch(() => shoppingList.value.length, () => nextTick(() => initSortable('.shopping-list-container', shoppingList)));

        // 新增：監聽 Modal 狀態以鎖定背景滾動
        watch(() => Object.values(modalState).some(v => v), (isOpen) => {
            if (isOpen) document.body.classList.add('no-scroll');
            else document.body.classList.remove('no-scroll');
        });

        return {
          appVersion, lang, t, toggleLang, flightCardSkin, toggleSkin,
          activeFlight, formatTime, displayDate, getStatusClass,
          rate, currentLiveRate, lastRateUpdateLabel, handleCalcInput, calcResult, calcInput,
          itinerary, newItineraryItem, shoppingList, newShoppingItem, expenses, newExpense, expenseFilter,
          prepList, newPreNote, members, infoText,
          modalState, openModal, saveItem, deleteItem,
          totalExpense, expensesBreakdown, settlementList,
          isScrolled, syncState, isDraggingExpense, formatNumber: (n) => Number(n).toLocaleString()
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
